
function varargout = frequency_response1(varargin)
% FREQUENCY_RESPONSE1 MATLAB code for frequency_response1.fig
%      FREQUENCY_RESPONSE1, by itself, creates a new FREQUENCY_RESPONSE1 or raises the existing
%      singleton*.
%
%      H = FREQUENCY_RESPONSE1 returns the handle to a new FREQUENCY_RESPONSE1 or the handle to
%      the existing singleton*.
%
%      FREQUENCY_RESPONSE1('CALLBACK',hObject,eventData,handles,...) calls the local
%      function named CALLBACK in FREQUENCY_RESPONSE1.M with the given input arguments.
%
%      FREQUENCY_RESPONSE1('Property','Value',...) creates a new FREQUENCY_RESPONSE1 or raises the
%      existing singleton*.  Starting from the left, property value pairs are
%      applied to the GUI before frequency_response1_OpeningFcn gets called.  An
%      unrecognized property name or invalid value makes property application
%      stop.  All inputs are passed to frequency_response1_OpeningFcn via varargin.
%
%      *See GUI Options on GUIDE's Tools menu.  Choose "GUI allows only one
%      instance to run (singleton)".
%
% See also: GUIDE, GUIDATA, GUIHANDLES

% Edit the above text to modify the response to help frequency_response1

% Last Modified by GUIDE v2.5 26-May-2015 14:29:46

% Begin initialization code - DO NOT EDIT
gui_Singleton = 1;
gui_State = struct('gui_Name',       mfilename, ...
                   'gui_Singleton',  gui_Singleton, ...
                   'gui_OpeningFcn', @frequency_response1_OpeningFcn, ...
                   'gui_OutputFcn',  @frequency_response1_OutputFcn, ...
                   'gui_LayoutFcn',  [] , ...
                   'gui_Callback',   []);
if nargin && ischar(varargin{1})
    gui_State.gui_Callback = str2func(varargin{1});
end

if nargout
    [varargout{1:nargout}] = gui_mainfcn(gui_State, varargin{:});
else
    gui_mainfcn(gui_State, varargin{:});
end
% End initialization code - DO NOT EDIT


% --- Executes just before frequency_response1 is made visible.
function frequency_response1_OpeningFcn(hObject, eventdata, handles, varargin)
% This function has no output args, see OutputFcn.
% hObject    handle to figure
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
% varargin   command line arguments to frequency_response1 (see VARARGIN)

% Choose default command line output for frequency_response1
handles.output = hObject;

% Update handles structure
guidata(hObject, handles);

% UIWAIT makes frequency_response1 wait for user response (see UIRESUME)
% uiwait(handles.figure1);


% --- Outputs from this function are returned to the command line.
function varargout = frequency_response1_OutputFcn(hObject, eventdata, handles) 
% varargout  cell array for returning output args (see VARARGOUT);
% hObject    handle to figure
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Get default command line output from handles structure
varargout{1} = handles.output;


% --- Executes on button press in Pbreceivedata.
function Pbreceivedata_Callback(hObject, eventdata, handles)

filename = handles.filename;
if strfind(filename,'bmp')> 0
    x=imread(filename);

    axes(handles.axes2);
    fmin=-0.01*(10^9);% fréquence minimale donnée
    fmax=0.01*(10^9);%fréquence maximale donnée
    Fe=(fmax-fmin)/length(x);% fréquence d'échantillage
    f=fmin:Fe:fmax-Fe;% l'axe fréquentiel

    x=abs(fft(x));

    plot(f,x)


    %Reponse impulsionnelle
    axes(handles.axes3);
    x1=abs(ifft(x));
    t=0:1/Fe:1/Fe*(length(x)-1);% l'axe temporel
    %stem(t,x1)
    plot(t,x1)

    N=length(x);
    fmax=255;
    [X,Y]=size(x);
    b=zeros(X,Y);
    %Calcul du pas de quantification
    q=fmax/N;
    %Calcul des valeurs quantifiées
    for i=1:X
        for j=1:Y
            if x(i,j)~=fmax
                k=floor(x(i,j)/q);
            else
                k=N-1;
            end
            b(i,j)=(k+1/2)*q;
        end
    end
    b=b/255; %pour affichage l'image quantifiée
    E=0;
    for i1 = 1:256,
        for i2 = 1: 256,
            a=x(i1,i2);%1ère image
            a2 = b(i1,i2);
            E=E+(double(a)-double(a2))^2;%la somme d'erreur
        end;
        EQM = E*(1/(i1*i2)); %la moyenne d'erreur
    end;
    psnr=(10*log((255^2)/(EQM)));%calcul de peak signal noise ratio
    set(handles.psnr,'String',psnr);

    %err=strcmp(x, x);% comparer les data émises  et data reçues en binaire et
    %afficher (1) si les elements sont les memes et (0) s'ils sont différents%
    % %calcul de l'erreur quadratique
    I_k=x(1:2:length(x)); %calcul de la partie imaginaire de Data émise
    Q_k=x(2:2:length(x));%calcul de la partie réelle de Data émise

    I_k_mes=x(1:2:length(x)); %calcul de la partie imaginaire de Data reçue
    Q_k_mes=x(2:2:length(x));%calcul de la partie réelle de Data reçue

    Er_k=((I_k-I_k_mes).^2)+((Q_k-Q_k_mes).^2);

    %calcul de la partie réelle au carré de Data 
    N=length(Q_k);
    [M2,N2]=size(Q_k);
    s=zeros(M2,N2);
    for i=1:N
        I_k=s+(I_k.*I_k);
    end
    I_k=I_k/N;
    
    %calcul de la partie imaginaire au carré de Data
    l=zeros(M2,N2);
    for j=1:N
        Q_k=l+(Q_k.*Q_k);
    end
    Q_k=Q_k/N;
    SNR_k=10*log((I_k+Q_k)/Er_k);%en dB
    SNR=min(SNR_k);% valeur minimale de snr
    set(handles.snr,'String',SNR);% affichage de SNR en dB
elseif strfind(filename,'mp3')> 0

    file = fopen(filename);
    x = fread(file);
    [y1]=audioread(filename);
    [y2]=audioread(filename);
    [c1x,c1y]=size(y1);
    [c2x,c2y]=size(y1);
    if c1x ~= c2x
        disp('dimeonsions do not agree');
    else
        R=c1x;
        C=c1y;
        err = sum((y1-y2).^2)/(R*C);
        sumerr = sum(err);
        MSE=sqrt(sumerr);
        MAXVAL=255;
        PSNR = 20*log10(MAXVAL.^2/MSE); 
        set(handles.psnr,'String',PSNR);
    end
elseif strfind(filename,'mp4') >0
    file = fopen(filename);

    x = fread(file);
    xyloObj = VideoReader(filename);
    vidHeight = xyloObj.Height;
    vidWidth = xyloObj.Width;
%     PSNR = yuvpsnr(filename,filename,vidWidth,vidHeight,'422','yuv');
%     set(handles.psnr,'String',PSNR);
elseif strfind(filename,'avi') >0
    file = fopen(filename);

    x = fread(file);
end;
b = imnoise(x,'gaussian',0.02);
x=dec2bin(x);%pour rendre l'image émise en binaire
b=dec2bin(b);%pour rendre l'image reçue en binaire



[M1,N1]=size(b);%definir la taille_ligne et taille_colonne
bit_error=0;
for i=1:M1
    for k=1:N1
        if x(i,k)~=b(i,k)% si les images sont différentes faire%
         bit_error=bit_error+1;
        end
    end
end
  
   
  bit_emis=M1*N1;
  Ber=(bit_error/bit_emis);%calcul de taux d'erreurs binaires
  set(handles.Trber,'String',Ber);% affichage de Ber en dB
  





function psnr_Callback(hObject, eventdata, handles)
% hObject    handle to psnr (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hints: get(hObject,'String') returns contents of psnr as text
%        str2double(get(hObject,'String')) returns contents of psnr as a double


% --- Executes during object creation, after setting all properties.
function psnr_CreateFcn(hObject, eventdata, handles)
% hObject    handle to psnr (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc && isequal(get(hObject,'BackgroundColor'), get(0,'defaultUicontrolBackgroundColor'))
    set(hObject,'BackgroundColor','white');
end


% --- If Enable == 'on', executes on mouse press in 5 pixel border.
% --- Otherwise, executes on mouse press in 5 pixel border or over psnr.
function psnr_ButtonDownFcn(hObject, eventdata, handles)
% hObject    handle to psnr (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)



function Trber_Callback(hObject, eventdata, handles)
% hObject    handle to Trber (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hints: get(hObject,'String') returns contents of Trber as text
%        str2double(get(hObject,'String')) returns contents of Trber as a double


% --- Executes during object creation, after setting all properties.
function Trber_CreateFcn(hObject, eventdata, handles)
% hObject    handle to Trber (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc && isequal(get(hObject,'BackgroundColor'), get(0,'defaultUicontrolBackgroundColor'))
    set(hObject,'BackgroundColor','white');
end




% --- Executes on selection change in receivechannels.
function receivechannels_Callback(hObject, eventdata, handles)
% hObject    handle to receivechannels (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hints: contents = cellstr(get(hObject,'String')) returns receivechannels contents as cell array
%        contents{get(hObject,'Value')} returns selected item from receivechannels



% --- Executes during object creation, after setting all properties.
function receivechannels_CreateFcn(hObject, eventdata, handles)
% hObject    handle to receivechannels (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: listbox controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc && isequal(get(hObject,'BackgroundColor'), get(0,'defaultUicontrolBackgroundColor'))
    set(hObject,'BackgroundColor','white');
end

% --- Executes on selection change in listbox2.
function listbox2_Callback(hObject, eventdata, handles)
% hObject    handle to listbox2 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hints: contents = cellstr(get(hObject,'String')) returns listbox2 contents as cell array
%        contents{get(hObject,'Value')} returns selected item from listbox2


index_selected = get(hObject, 'Value' );
switch index_selected
    case 1
        freq = sprintf( '2.41 GHz');
        set(handles.Carrierfrequen, 'String' , freq);
    case  2
        freq = sprintf( '2.415 GHz');
        set(handles.Carrierfrequen, 'String', freq);
    case  3
        freq = sprintf( '2.42 GHz');
      set(handles.Carrierfrequen, 'String' , freq);
    case  4
        freq = sprintf('2.425 GHz');
        set(handles.Carrierfrequen, 'String' , freq);        
    case  5
        freq = sprintf('2.43 GHz');
        set(handles.Carrierfrequen, 'String' , freq);
    case  6
        freq = sprintf('2.435 GHz');
        set(handles.Carrierfrequen, 'String' , freq);
    case  7
        freq = sprintf('2.44 GHz');
        set(handles.Carrierfrequen, 'String' , freq);
    case  8
        freq = sprintf('2.445 GHz');
        set(handles.Carrierfrequen, 'String' , freq);              
    case  9
        freq = sprintf('2.45 GHz');
        set(handles.Carrierfrequen, 'String' , freq);
    case  10
        freq = sprintf('2.455 GHz');
        set(handles.Carrierfrequen, 'String' , freq);
    case  11
        freq = sprintf('2.46 GHz');
       set(handles.Carrierfrequen, 'String' , freq);
    case  12
        freq = sprintf('2.465 GHz');
        set(handles.Carrierfrequen, 'String' , freq);  
    case  13
        freq = sprintf('2.47 GHz');
        set(handles.Carrierfrequen, 'String' , freq);        
end


% --- Executes during object creation, after setting all properties.
function listbox2_CreateFcn(hObject, eventdata, ~)
% hObject    handle to listbox2 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: listbox controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc && isequal(get(hObject,'BackgroundColor'), get(0,'defaultUicontrolBackgroundColor'))
    set(hObject,'BackgroundColor','white');
end



function snr_Callback(hObject, eventdata, handles)
% hObject    handle to snr (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hints: get(hObject,'String') returns contents of snr as text
%        str2double(get(hObject,'String')) returns contents of snr as a double


% --- Executes during object creation, after setting all properties.
function snr_CreateFcn(hObject, eventdata, handles)
% hObject    handle to snr (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc && isequal(get(hObject,'BackgroundColor'), get(0,'defaultUicontrolBackgroundColor'))
    set(hObject,'BackgroundColor','white');
end



function Carrierfrequen_Callback(hObject, eventdata, handles)
% hObject    handle to Carrierfrequen (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hints: get(hObject,'String') returns contents of Carrierfrequen as text
%        str2double(get(hObject,'String')) returns contents of Carrierfrequen as a double


% --- Executes during object creation, after setting all properties.
function Carrierfrequen_CreateFcn(hObject, eventdata, handles)
% hObject    handle to Carrierfrequen (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc && isequal(get(hObject,'BackgroundColor'), get(0,'defaultUicontrolBackgroundColor'))
    set(hObject,'BackgroundColor','white');
end


% --- Executes when selected object is changed in uipanel12.
function uipanel12_SelectionChangeFcn(hObject, eventdata, handles)
% hObject    handle to the selected object in uipanel12 
% eventdata  structure with the following fields (see UIBUTTONGROUP)
%	EventName: string 'SelectionChanged' (read only)
%	OldValue: handle of the previously selected object or empty if none was selected
%	NewValue: handle of the currently selected object
% handles    structure with handles and user data (see GUIDATA)
switch get(eventdata.NewValue,'Tag') % Get Tag of selected object.
    case 'radiobutton1'
        global rb;
        rb = 1;%if SISO is selected
        set(handles.antreceiver,'Enable','on');%Enable to select antreceiver
        set(handles.antreceiver2,'Enable','on');%Enable to select antreceiver2
        set(handles.antreceiver,'Value',1);%Select antreceiver by default
        set(handles.antreceiver2,'Value',0);%Unselect antreceiver2 by default
    case 'radiobutton2'
        rb = 0;%if MIMO is selected, we need to select both option and prevent the user to change the selection
        set(handles.antreceiver,'Value',1);%Select antreceiver
        set(handles.antreceiver2,'Value',1);%Select antreceiver2
        set(handles.antreceiver,'Enable','off');%Disable to select antreceiver
        set(handles.antreceiver2,'Enable','off');%Disable to select antreceiver2
        
end

% --- Executes on button press in antreceiver.
function antreceiver_Callback(hObject, eventdata, handles)
% hObject    handle to antreceiver (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hint: get(hObject,'Value') returns toggle state of antreceiver
global rb;% call value from uipanel6
% if antreceiver is selected and rb = 1(SISO is selected)
if (get(hObject,'Value') == get(hObject,'Max'))&&(rb == 1);
	set(handles.antreceiver2,'Value',0);%unselect antreceiver2 to assure only one is selected
else
% if antreceiver is unselected(to avoid none of the option is selected) 
    set(handles.antreceiver2,'Value',1);%select antreceiver
end


% --- Executes on button press in antreceiver2.
function antreceiver2_Callback(hObject, eventdata, handles)
% hObject    handle to antreceiver2 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hint: get(hObject,'Value') returns toggle state of antreceiver2


global rb;% call value from uipanel6
% if antreceiver2 is selected and rb = 1(SISO is selected)
if (get(hObject,'Value') == get(hObject,'Max'))&&(rb == 1);
	set(handles.antreceiver,'Value',0);%unselect antreceiver to assure only one is selected
else
% if antreceiver2 is unselected(to avoid none of the option is selected) 
    set(handles.antreceiver,'Value',1);%select antreceiver
end


% --- Executes on button press in selectdata.
function selectdata_Callback(hObject, eventdata, handles)
% hObject    handle to selectdata (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
% 
[filename,pathname] = uigetfile({'*.jpg';'*.mp3';'*wav';'*.mp4';'*avi';'*bmp'},'File Selector');%Enable user to browse file
file = strcat(pathname,filename);%Compile fullpath to the selected file
handles = guidata(hObject);
setappdata(0,'file',file);%store the value in GUI, so that other GUI can recall
 handles.filename = filename;
 guidata(hObject,handles);


% --- Executes during object creation, after setting all properties.
function axes1_CreateFcn(hObject, eventdata, handles)
% hObject    handle to axes1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: place code in OpeningFcn to populate axes1


% --- Executes on button press in showdata.
function showdata_Callback(hObject, eventdata, handles)
% hObject    handle to showdata (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
filename =handles.filename;
if strfind(filename,'bmp')> 0
    axes(handles.axes1);
    x =imread(filename);
    b = imnoise(x,'gaussian',0.02);
    imshow(b);%affichage de l'image
elseif strfind(filename,'jpg')> 0
    axes(handles.axes1);
    x =imread(filename);
    b = imnoise(x,'gaussian',0.02);
    imshow(b);%affichage de l'image    
elseif strfind(filename,'mp3')> 0
    Audioplayer;
elseif strfind(filename,'avi')> 0
    movieCommand;
elseif strfind(filename,'mp4') >0
    implay(filename);
    [y,f]=audioread(filename);
    pl=audioplayer(y,f);
    handles.pl=pl;
    resume(pl);
    guidata(hObject,handles);
 end;
 handles.filename = filename;
 guidata(hObject,handles);


% --- Executes on button press in cleardata.
function cleardata_Callback(hObject, eventdata, handles)
% hObject    handle to cleardata (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
cla(handles.axes1,'reset');
cla(handles.axes2,'reset');
cla(handles.axes3,'reset');
set(handles.snr,'String','');
set(handles.psnr,'String','');
set(handles.Trber,'String','');
